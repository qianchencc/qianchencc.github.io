<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 数据采集课程作业GitHub 2025 </title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <!-- Marked.js for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Local Data -->
    <script src="data.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background-color: #f8fafc; }
        .card { @apply bg-white rounded-xl shadow-sm border border-slate-200 p-6 transition-all hover:shadow-md; }
        .gradient-text { @apply bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600; }
        /* Markdown Styles */
        .prose h3 { @apply text-lg font-bold text-slate-800 mb-2 mt-4; }
        .prose p { @apply text-slate-600 leading-relaxed mb-4; }
        .prose ul { @apply list-disc list-inside text-slate-600 mb-4 ml-4; }
        .prose strong { @apply font-bold text-slate-800; }
    </style>
</head>
<body id="app">
    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                <h1 class="text-xl font-bold text-slate-900">GitHub 2025 数据分析</h1>
            </div>
            <div class="text-sm text-slate-500">
                更新于: {{ data.meta.updated_at }}
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        
        <!-- Intro Section -->
        <section class="grid md:grid-cols-2 gap-8">
            <div class="card bg-gradient-to-br from-blue-50 to-white border-blue-100">
                <h2 class="text-lg font-semibold text-blue-800 mb-3 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    数据采集
                </h2>
                <div class="prose text-sm" v-html="renderMarkdown(data.texts.intro.collection)"></div>
            </div>
            <div class="card bg-gradient-to-br from-emerald-50 to-white border-emerald-100">
                <h2 class="text-lg font-semibold text-emerald-800 mb-3 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    清洗原则
                </h2>
                <div class="prose text-sm" v-html="renderMarkdown(data.texts.intro.integration)"></div>
            </div>
        </section>

        <!-- Top Projects Section -->
        <section>
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">Top 20 Projects 榜单</h2>
                <div class="flex bg-slate-100 p-1 rounded-lg">
                    <button @click="activeTab = 'groupA'" :class="{'bg-white shadow-sm text-blue-600': activeTab === 'groupA', 'text-slate-500': activeTab !== 'groupA'}" class="px-4 py-1.5 text-sm font-medium rounded-md transition-all">
                        Group A (2025 New)
                    </button>
                    <button @click="activeTab = 'groupB'" :class="{'bg-white shadow-sm text-blue-600': activeTab === 'groupB', 'text-slate-500': activeTab !== 'groupB'}" class="px-4 py-1.5 text-sm font-medium rounded-md transition-all">
                        Group B (Old)
                    </button>
                </div>
            </div>
            
            <!-- Cards Grid (Top 20) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <a v-for="repo in currentList.slice(0, 20)" :key="repo.full_name" :href="repo.html_url" target="_blank" class="card group hover:border-blue-300 p-5 flex flex-col h-full relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-110"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-mono text-slate-400">Total: {{ repo.stars.toLocaleString() }}</span>
                            <span class="text-xs font-mono text-emerald-500">+{{ repo.increment.toLocaleString() }}</span>
                        </div>
                        <h3 class="font-bold text-slate-800 mb-2 truncate group-hover:text-blue-600" :title="repo.full_name">{{ repo.full_name }}</h3>
                        <p class="text-xs text-slate-500 line-clamp-3">{{ repo.description }}</p>
                    </div>
                </a>
            </div>

            <!-- Full List Table (Paginated) -->
            <div class="card overflow-hidden">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-4">
                        <h3 class="font-bold text-slate-700">完整榜单 ({{ tableListFiltered.length }})</h3>
                        <!-- Group Filter -->
                        <div class="flex bg-slate-100 p-0.5 rounded-lg text-xs">
                            <button @click="tableFilter = 'all'" :class="{'bg-white shadow-sm text-blue-600': tableFilter === 'all', 'text-slate-500': tableFilter !== 'all'}" class="px-3 py-1 font-medium rounded-md transition-all">All</button>
                            <button @click="tableFilter = 'A'" :class="{'bg-white shadow-sm text-blue-600': tableFilter === 'A', 'text-slate-500': tableFilter !== 'A'}" class="px-3 py-1 font-medium rounded-md transition-all">Group A</button>
                            <button @click="tableFilter = 'B'" :class="{'bg-white shadow-sm text-blue-600': tableFilter === 'B', 'text-slate-500': tableFilter !== 'B'}" class="px-3 py-1 font-medium rounded-md transition-all">Group B</button>
                        </div>
                        <!-- Sort Control -->
                        <div class="flex items-center gap-2 text-xs text-slate-500 border-l pl-4 border-slate-200">
                            <span>Sort by:</span>
                            <div class="flex bg-slate-100 p-0.5 rounded-lg">
                                <button @click="sortKey = 'stars'" :class="{'bg-white shadow-sm text-amber-600': sortKey === 'stars', 'text-slate-500': sortKey !== 'stars'}" class="px-3 py-1 font-medium rounded-md transition-all flex items-center gap-1">
                                    Total Stars
                                </button>
                                <button @click="sortKey = 'increment'" :class="{'bg-white shadow-sm text-emerald-600': sortKey === 'increment', 'text-slate-500': sortKey !== 'increment'}" class="px-3 py-1 font-medium rounded-md transition-all flex items-center gap-1">
                                    Increment
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" v-model="searchQuery" placeholder="搜索项目..." class="border border-slate-300 rounded px-3 py-1 text-sm focus:outline-none focus:border-blue-500">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-500">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                            <tr>
                                <th class="px-6 py-3">Rank</th>
                                <th class="px-6 py-3">Group</th>
                                <th class="px-6 py-3">Project</th>
                                <th class="px-6 py-3 text-right">Total Stars</th>
                                <th class="px-6 py-3 text-right">Increment</th>
                                <th class="px-6 py-3">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(repo, index) in paginatedList" :key="repo.full_name" class="bg-white border-b hover:bg-slate-50">
                                <td class="px-6 py-4 font-mono text-slate-400">{{ (currentPage - 1) * pageSize + index + 1 }}</td>
                                <td class="px-6 py-4">
                                    <span :class="repo.group === 'A' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'" class="px-2 py-0.5 rounded text-xs font-bold">{{ repo.group }}</span>
                                </td>
                                <td class="px-6 py-4 font-medium text-slate-900">
                                    <a :href="repo.html_url" target="_blank" class="hover:text-blue-600 hover:underline">{{ repo.full_name }}</a>
                                </td>
                                <td class="px-6 py-4 text-right">{{ repo.stars.toLocaleString() }}</td>
                                <td class="px-6 py-4 text-right text-emerald-600">+{{ repo.increment.toLocaleString() }}</td>
                                <td class="px-6 py-4 truncate max-w-xs" :title="repo.description">{{ repo.description }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination -->
                <div class="flex justify-between items-center mt-4 px-2">
                    <button @click="prevPage" :disabled="currentPage === 1" class="px-3 py-1 text-xs font-medium text-slate-500 bg-white border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50">Prev</button>
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-slate-500">Page {{ currentPage }} of {{ totalPages }}</span>
                        <input type="number" min="1" :max="totalPages" v-model="jumpPage" @keydown.enter="goToPage" class="w-12 text-xs border border-slate-300 rounded px-1 py-0.5 text-center focus:outline-none focus:border-blue-500" placeholder="Go">
                        <button @click="goToPage" class="px-2 py-0.5 text-xs bg-blue-50 text-blue-600 rounded border border-blue-200 hover:bg-blue-100">Go</button>
                    </div>
                    <button @click="nextPage" :disabled="currentPage === totalPages" class="px-3 py-1 text-xs font-medium text-slate-500 bg-white border border-slate-300 rounded hover:bg-slate-100 disabled:opacity-50">Next</button>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section class="space-y-8">
            <h2 class="text-2xl font-bold text-slate-800">假设验证分析</h2>
            
            <!-- H1 -->
            <div class="card grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 h-[400px]" ref="chartH1"></div>
                <div class="flex flex-col justify-center space-y-4">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2">假设一：社区健康度 (Star/Fork Ratio)</h3>
                        <div class="prose text-sm" v-html="renderMarkdown(data.texts.analysis.h1.conclusion)"></div>
                    </div>
                    <div class="bg-amber-50 border-l-4 border-amber-400 p-4">
                        <h4 class="text-xs font-bold text-amber-700 uppercase mb-1">局限性分析</h4>
                        <div class="prose text-xs text-amber-800" v-html="renderMarkdown(data.texts.analysis.h1.limitation)"></div>
                    </div>
                </div>
            </div>

            <!-- H2 -->
            <div class="card grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 h-[400px]" ref="chartH2"></div>
                <div class="flex flex-col justify-center space-y-4">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2">假设二：维护力枯竭 (Inactive Days)</h3>
                        <div class="prose text-sm" v-html="renderMarkdown(data.texts.analysis.h2.conclusion)"></div>
                    </div>
                    <div class="bg-amber-50 border-l-4 border-amber-400 p-4">
                        <h4 class="text-xs font-bold text-amber-700 uppercase mb-1">局限性分析</h4>
                        <div class="prose text-xs text-amber-800" v-html="renderMarkdown(data.texts.analysis.h2.limitation)"></div>
                    </div>
                </div>
            </div>

            <!-- H3 -->
            <div class="card grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 h-[400px]" ref="chartH3"></div>
                <div class="flex flex-col justify-center space-y-4">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2">假设三：防御性开源 (License)</h3>
                        <div class="prose text-sm" v-html="renderMarkdown(data.texts.analysis.h3.conclusion)"></div>
                    </div>
                    <div class="bg-amber-50 border-l-4 border-amber-400 p-4">
                        <h4 class="text-xs font-bold text-amber-700 uppercase mb-1">局限性分析</h4>
                        <div class="prose text-xs text-amber-800" v-html="renderMarkdown(data.texts.analysis.h3.limitation)"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary Section -->
        <section class="card bg-slate-50 border-slate-200">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">项目总结</h2>
            <div class="prose max-w-none text-slate-700" v-html="renderMarkdown(data.texts.summary)"></div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-slate-400 py-8 text-sm">
            <p>Generated by Gemini CLI Agent &copy; 2025</p>
        </footer>
    </main>

    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;

        createApp({
            setup() {
                const data = window.dashboardData;
                const activeTab = ref('groupA');
                
                // Table State
                const tableFilter = ref('all');
                const sortKey = ref('stars'); // 'stars' or 'increment'
                const searchQuery = ref('');
                const currentPage = ref(1);
                const jumpPage = ref(1);
                const pageSize = 10;
                
                // Prepare Merged List with Group Tag
                const allProjects = [
                    ...data.fullLists.groupA.map(i => ({...i, group: 'A'})),
                    ...data.fullLists.groupB.map(i => ({...i, group: 'B'}))
                ];

                const chartH1 = ref(null);
                const chartH2 = ref(null);
                const chartH3 = ref(null);

                // Top Cards List (still follows activeTab)
                const currentList = computed(() => {
                    return data.fullLists[activeTab.value];
                });

                // Table List (follows tableFilter & Sort)
                const tableListFiltered = computed(() => {
                    let list = allProjects;
                    
                    // 1. Filter by Group
                    if (tableFilter.value !== 'all') {
                        list = list.filter(i => i.group === tableFilter.value);
                    }

                    // 2. Filter by Search
                    if (searchQuery.value) {
                        const q = searchQuery.value.toLowerCase();
                        list = list.filter(item => 
                            item.full_name.toLowerCase().includes(q) || 
                            item.description.toLowerCase().includes(q)
                        );
                    }
                    
                    // 3. Sort (Always Descending)
                    return [...list].sort((a, b) => b[sortKey.value] - a[sortKey.value]);
                });

                const paginatedList = computed(() => {
                    const start = (currentPage.value - 1) * pageSize;
                    return tableListFiltered.value.slice(start, start + pageSize);
                });

                const totalPages = computed(() => Math.ceil(tableListFiltered.value.length / pageSize));

                // Reset page on filter changes
                watch([tableFilter, searchQuery], () => { 
                    currentPage.value = 1; 
                    jumpPage.value = 1;
                });
                
                // Sync jumpPage display
                watch(currentPage, (newVal) => {
                    jumpPage.value = newVal;
                });

                const goToPage = () => {
                    let page = parseInt(jumpPage.value);
                    if (isNaN(page) || page < 1) page = 1;
                    if (page > totalPages.value) page = totalPages.value;
                    currentPage.value = page;
                    jumpPage.value = page; // Sync back in case of correction
                };
                
                const prevPage = () => { if(currentPage.value > 1) currentPage.value--; };
                const nextPage = () => { if(currentPage.value < totalPages.value) currentPage.value++; };

                const renderMarkdown = (text) => {
                    return marked.parse(text || '');
                };

                onMounted(() => {
                    initCharts();
                    window.addEventListener('resize', resizeCharts);
                });

                let c1, c2, c3;

                const initCharts = () => {
                    // Chart H1: Pie Chart
                    c1 = echarts.init(chartH1.value);
                    c1.setOption({
                        title: { text: '社区互动类型分布', left: 'center' },
                        tooltip: { trigger: 'item' },
                        legend: { bottom: 0 },
                        series: [
                            {
                                name: 'Group A (2025)',
                                type: 'pie',
                                radius: ['40%', '70%'],
                                center: ['25%', '50%'],
                                itemStyle: { borderRadius: 5, borderColor: '#fff', borderWidth: 2 },
                                label: { show: false },
                                data: data.charts.h1.A
                            },
                            {
                                name: 'Group B (Old)',
                                type: 'pie',
                                radius: ['40%', '70%'],
                                center: ['75%', '50%'],
                                itemStyle: { borderRadius: 5, borderColor: '#fff', borderWidth: 2 },
                                label: { show: false },
                                data: data.charts.h1.B
                            }
                        ],
                        graphic: [
                            { type: 'text', left: '25%', top: '48%', style: { text: '2025 New', textAlign: 'center', fill: '#666' } },
                            { type: 'text', left: '75%', top: '48%', style: { text: 'Old Projects', textAlign: 'center', fill: '#666' } }
                        ]
                    });

                    // Chart H2: Histogram (Bar Chart)
                    c2 = echarts.init(chartH2.value);
                    c2.setOption({
                        title: { text: '停更天数分布频率 (%)', left: 'center' },
                        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
                        legend: { bottom: 0 },
                        grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
                        xAxis: { 
                            type: 'category', 
                            data: data.charts.h2.categories,
                            name: '停更时长 (Days Inactive)'
                        },
                        yAxis: { 
                            type: 'value', 
                            name: '项目占比 (%)'
                        },
                        series: [
                            {
                                name: 'Group A (2025 New)',
                                type: 'bar',
                                data: data.charts.h2.series[0].data,
                                itemStyle: { color: '#3b82f6' }
                            },
                            {
                                name: 'Group B (Old)',
                                type: 'bar',
                                data: data.charts.h2.series[1].data,
                                itemStyle: { color: '#ef4444' }
                            }
                        ]
                    });

                    // Chart H3: Bar Chart
                    c3 = echarts.init(chartH3.value);
                    const extract = (groupData, key) => {
                        const item = groupData.find(i => i.name.includes(key));
                        return item ? item.value : 0;
                    };
                    const totalA = data.charts.h3.A.reduce((a, b) => a + b.value, 0);
                    const totalB = data.charts.h3.B.reduce((a, b) => a + b.value, 0);
                    const getPct = (arr, key, total) => ((extract(arr, key) / total) * 100).toFixed(1);

                    const cats = ['Permissive', 'Defensive', 'Other', 'None/Unknown'];
                    const seriesData = cats.map(cat => ({
                        name: cat,
                        type: 'bar',
                        data: [
                            getPct(data.charts.h3.A, cat, totalA),
                            getPct(data.charts.h3.B, cat, totalB)
                        ]
                    }));

                    c3.setOption({
                        title: { text: 'License 类型占比 (%)', left: 'center' },
                        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
                        legend: { bottom: 0 },
                        grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
                        xAxis: { type: 'value', max: 100 },
                        yAxis: { type: 'category', data: ['Group A (2025)', 'Group B (Old)'] },
                        series: seriesData
                    });
                };

                const resizeCharts = () => {
                    c1 && c1.resize();
                    c2 && c2.resize();
                    c3 && c3.resize();
                };

                return {
                    data,
                    activeTab,
                    currentList,
                    tableListFiltered,
                    paginatedList,
                    totalPages,
                    currentPage,
                    jumpPage,
                    pageSize,
                    searchQuery,
                    tableFilter,
                    sortKey,
                    chartH1,
                    chartH2,
                    chartH3,
                    renderMarkdown,
                    goToPage,
                    prevPage,
                    nextPage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
